{"ast":null,"code":"import React from 'react';\nimport { Delaunay } from 'd3-delaunay'; //\n\nimport { translate } from '../utils/Utils';\nimport useChartContext from '../utils/chartContext';\nimport { line } from 'd3-shape';\nimport { getPrimaryGroupLength, getPrimaryLength } from '../seriesTypes/Bar';\nexport default function Voronoi() {\n  var _useChartContext = useChartContext(),\n      getOptions = _useChartContext.getOptions,\n      focusedDatumState = _useChartContext.focusedDatumState;\n\n  var setFocusedDatum = focusedDatumState[1];\n\n  var _getOptions = getOptions(),\n      onFocusDatum = _getOptions.onFocusDatum,\n      onClickDatum = _getOptions.onClickDatum,\n      tooltip = _getOptions.tooltip,\n      primaryCursor = _getOptions.primaryCursor,\n      secondaryCursor = _getOptions.secondaryCursor,\n      showVoronoi = _getOptions.showVoronoi,\n      interactionMode = _getOptions.interactionMode;\n\n  var handleFocus = React.useCallback(function (datum) {\n    var _getOptions$onFocusDa, _getOptions2;\n\n    (_getOptions$onFocusDa = (_getOptions2 = getOptions()).onFocusDatum) == null ? void 0 : _getOptions$onFocusDa.call(_getOptions2, datum);\n    setFocusedDatum(datum);\n  }, [getOptions, setFocusedDatum]);\n  var needsVoronoi = onFocusDatum || onClickDatum || tooltip || primaryCursor || secondaryCursor || showVoronoi;\n\n  if (!needsVoronoi) {\n    return null;\n  }\n\n  var props = {\n    handleFocus: handleFocus\n  };\n\n  if (interactionMode === 'closest') {\n    return /*#__PURE__*/React.createElement(SingleVoronoi, props);\n  }\n\n  return /*#__PURE__*/React.createElement(PrimaryVoronoi, props);\n}\n\nfunction PrimaryVoronoi(_ref) {\n  var handleFocus = _ref.handleFocus;\n\n  var _useChartContext2 = useChartContext(),\n      primaryAxis = _useChartContext2.primaryAxis,\n      secondaryAxes = _useChartContext2.secondaryAxes,\n      getOptions = _useChartContext2.getOptions,\n      gridDimensions = _useChartContext2.gridDimensions,\n      datumsByInteractionGroup = _useChartContext2.datumsByInteractionGroup;\n\n  var stackedVoronoi = secondaryAxes.length === 1 && secondaryAxes[0].stacked;\n  var useBarPx = secondaryAxes.every(function (d) {\n    return d.elementType === 'bar' && !d.stacked;\n  });\n  return React.useMemo(function () {\n    var preColumns = Array.from(datumsByInteractionGroup.entries()).map(function (_ref2) {\n      var _ = _ref2[0],\n          datums = _ref2[1];\n      return datums;\n    }).filter(function (datums) {\n      var datum = datums[0];\n\n      if (!datum) {\n        return;\n      }\n\n      var primaryValue = datum.primaryValue;\n      return primaryValue !== 'undefined' && primaryValue !== null;\n    }).sort(function (a, b) {\n      var aAxis = secondaryAxes.find(function (d) {\n        return d.id === a[0].secondaryAxisId;\n      });\n      var bAxis = secondaryAxes.find(function (d) {\n        return d.id === b[0].secondaryAxisId;\n      });\n      var aPx = getPrimary(a[0], primaryAxis, aAxis, useBarPx);\n      var bPx = getPrimary(b[0], primaryAxis, bAxis, useBarPx);\n      return aPx - bPx;\n    });\n\n    if (primaryAxis.isVertical) {\n      preColumns.reverse();\n    }\n\n    var columns = preColumns.map(function (datums, i, all) {\n      var _primaryAxis$scale$ra;\n\n      var datum = datums[0];\n      var prev = all[i - 1];\n      var next = all[i + 1];\n      var secondaryAxis = secondaryAxes.find(function (d) {\n        return d.id === datum.secondaryAxisId;\n      });\n      var primaryPx = getPrimary(datum, primaryAxis, secondaryAxis, useBarPx);\n      var range = (_primaryAxis$scale$ra = primaryAxis == null ? void 0 : primaryAxis.scale.range()) != null ? _primaryAxis$scale$ra : [0, 0];\n      var primaryStart = range[0],\n          primaryEnd = range[1];\n\n      if (prev) {\n        var _secondaryAxis = secondaryAxes.find(function (d) {\n          return d.id === prev[0].secondaryAxisId;\n        });\n\n        var prevPx = getPrimary(prev[0], primaryAxis, _secondaryAxis, useBarPx);\n        primaryStart = primaryPx - (primaryPx - prevPx) / 2;\n      }\n\n      if (next) {\n        var _secondaryAxis2 = secondaryAxes.find(function (d) {\n          return d.id === next[0].secondaryAxisId;\n        });\n\n        var nextPx = getPrimary(next[0], primaryAxis, _secondaryAxis2, useBarPx);\n        primaryEnd = primaryPx + (nextPx - primaryPx) / 2;\n      }\n\n      return {\n        primaryStart: primaryStart,\n        primaryEnd: primaryEnd,\n        primaryPx: primaryPx,\n        datumBoundaries: datums.filter(function (datum) {\n          var secondaryValue = datum.secondaryValue;\n          return typeof secondaryValue !== 'undefined' && secondaryValue !== null;\n        }).map(function (datum, i, all) {\n          var _secondaryAxis$scale3, _datum$stackData3, _secondaryAxis$scale$2;\n\n          var prev = all[i - 1];\n          var next = all[i + 1];\n          var secondaryAxis = secondaryAxes.find(function (d) {\n            return d.id === datum.secondaryAxisId;\n          });\n\n          if (stackedVoronoi) {\n            var _secondaryAxis$scale$, _datum$stackData, _datum$stackData2;\n\n            var _range = (_secondaryAxis$scale$ = secondaryAxis == null ? void 0 : secondaryAxis.scale.range()) != null ? _secondaryAxis$scale$ : [0, 0];\n\n            var stackData = [(_datum$stackData = datum.stackData) == null ? void 0 : _datum$stackData[0], (_datum$stackData2 = datum.stackData) == null ? void 0 : _datum$stackData2[1]];\n\n            if (secondaryAxis != null && secondaryAxis.isVertical) {\n              _range.reverse();\n\n              stackData.reverse();\n            }\n\n            var _secondaryStart = _range[0],\n                _secondaryEnd = _range[1];\n\n            if (prev) {\n              var _secondaryAxis$scale, _stackData$;\n\n              _secondaryStart = (_secondaryAxis$scale = secondaryAxis == null ? void 0 : secondaryAxis.scale((_stackData$ = stackData[0]) != null ? _stackData$ : NaN)) != null ? _secondaryAxis$scale : NaN;\n            }\n\n            if (next) {\n              var _secondaryAxis$scale2, _stackData$2;\n\n              _secondaryEnd = (_secondaryAxis$scale2 = secondaryAxis == null ? void 0 : secondaryAxis.scale((_stackData$2 = stackData[1]) != null ? _stackData$2 : NaN)) != null ? _secondaryAxis$scale2 : NaN;\n            }\n\n            return {\n              secondaryStart: _secondaryStart,\n              secondaryEnd: _secondaryEnd,\n              datum: datum\n            };\n          }\n\n          var value = (_secondaryAxis$scale3 = secondaryAxis == null ? void 0 : secondaryAxis.scale(secondaryAxis.stacked ? (_datum$stackData3 = datum.stackData) == null ? void 0 : _datum$stackData3[1] : datum.secondaryValue)) != null ? _secondaryAxis$scale3 : NaN;\n          var range = (_secondaryAxis$scale$2 = secondaryAxis == null ? void 0 : secondaryAxis.scale.range()) != null ? _secondaryAxis$scale$2 : [0, 0];\n\n          if (secondaryAxis != null && secondaryAxis.isVertical) {\n            range.reverse();\n          }\n\n          var secondaryStart = range[0],\n              secondaryEnd = range[1];\n\n          if (prev) {\n            var _prevAxis$scale, _prev$stackData;\n\n            var prevAxis = secondaryAxes.find(function (d) {\n              return d.id === (prev == null ? void 0 : prev.secondaryAxisId);\n            });\n            var prevValue = (_prevAxis$scale = prevAxis == null ? void 0 : prevAxis.scale(prevAxis.stacked ? (_prev$stackData = prev.stackData) == null ? void 0 : _prev$stackData[1] : prev.secondaryValue)) != null ? _prevAxis$scale : NaN;\n            secondaryStart = value - (value - prevValue) / 2;\n          }\n\n          if (next) {\n            var _nextAxis$scale, _next$stackData;\n\n            var nextAxis = secondaryAxes.find(function (d) {\n              return d.id === (next == null ? void 0 : next.secondaryAxisId);\n            });\n            var nextValue = (_nextAxis$scale = nextAxis == null ? void 0 : nextAxis.scale(nextAxis.stacked ? (_next$stackData = next.stackData) == null ? void 0 : _next$stackData[1] : next.secondaryValue)) != null ? _nextAxis$scale : NaN;\n            secondaryEnd = value + (nextValue - value) / 2;\n          }\n\n          return {\n            secondaryStart: secondaryStart,\n            secondaryEnd: secondaryEnd,\n            datum: datum\n          };\n        })\n      };\n    });\n    return /*#__PURE__*/React.createElement(\"g\", {\n      onMouseLeave: function onMouseLeave() {\n        return handleFocus(null);\n      },\n      style: {\n        transform: translate(gridDimensions.left, gridDimensions.top)\n      }\n    }, columns.map(function (column, i) {\n      return /*#__PURE__*/React.createElement(\"g\", {\n        key: column.primaryPx + \"_\" + i\n      }, column.datumBoundaries.map(function (datumBoundary, i) {\n        var x1 = !primaryAxis.isVertical ? column.primaryStart : datumBoundary.secondaryStart;\n        var x2 = !primaryAxis.isVertical ? column.primaryEnd : datumBoundary.secondaryEnd;\n        var y1 = !primaryAxis.isVertical ? datumBoundary.secondaryStart : column.primaryStart;\n        var y2 = !primaryAxis.isVertical ? datumBoundary.secondaryEnd : column.primaryEnd;\n        var x = Math.min(x1, x2);\n        var y = Math.min(y1, y2);\n        var xEnd = Math.max(x1, x2);\n        var yEnd = Math.max(y1, y2);\n        var height = Math.max(yEnd - y, 0);\n        var width = Math.max(xEnd - x, 0);\n        return /*#__PURE__*/React.createElement(\"rect\", {\n          key: i,\n          x: x,\n          y: y,\n          width: width,\n          height: height,\n          className: 'action-voronoi',\n          onMouseEnter: function onMouseEnter() {\n            return handleFocus(datumBoundary.datum);\n          },\n          style: {\n            fill: getOptions().dark ? '#ffffff33' : 'rgba(0,0,0,0.2)',\n            strokeWidth: 1,\n            stroke: getOptions().dark ? 'white' : 'black',\n            opacity: getOptions().showVoronoi ? 1 : 0\n          }\n        });\n      }));\n    }));\n  }, [datumsByInteractionGroup, primaryAxis, gridDimensions.left, gridDimensions.top, secondaryAxes, useBarPx, stackedVoronoi, handleFocus, getOptions]);\n}\n\nvar delaunayLineFn = line();\n\nfunction SingleVoronoi(_ref3) {\n  var handleFocus = _ref3.handleFocus;\n\n  var _useChartContext3 = useChartContext(),\n      primaryAxis = _useChartContext3.primaryAxis,\n      series = _useChartContext3.series,\n      secondaryAxes = _useChartContext3.secondaryAxes,\n      getOptions = _useChartContext3.getOptions,\n      gridDimensions = _useChartContext3.gridDimensions;\n\n  var polygons = null;\n  var voronoiData = [];\n  var useBarPx = secondaryAxes.every(function (d) {\n    return d.elementType === 'bar' && !d.stacked;\n  });\n  series.forEach(function (serie) {\n    serie.datums.filter(function (datum) {\n      var primaryValue = datum.primaryValue;\n      var secondaryValue = datum.secondaryValue;\n      return primaryValue !== 'undefined' && primaryValue !== null && secondaryValue !== 'undefined' && secondaryValue !== null;\n    }).forEach(function (datum) {\n      var secondaryAxis = secondaryAxes.find(function (d) {\n        return d.id === datum.secondaryAxisId;\n      });\n      var x = getX(datum, primaryAxis, secondaryAxis, useBarPx);\n      var y = getY(datum, primaryAxis, secondaryAxis, useBarPx);\n\n      if (typeof x !== 'number' || typeof y !== 'number' || Number.isNaN(y) || Number.isNaN(x)) {\n        return;\n      }\n\n      voronoiData.push({\n        x: x,\n        y: y,\n        datum: datum\n      });\n    });\n  });\n  var delaunay = Delaunay.from(voronoiData, function (d) {\n    return Math.max(d.x, 0);\n  }, function (d) {\n    return Math.max(d.y, 0);\n  });\n  var voronoi = delaunay.voronoi([0, 0, gridDimensions.width, gridDimensions.height]);\n  polygons = voronoi.cellPolygons();\n  polygons = Array.from(polygons);\n  return /*#__PURE__*/React.createElement(\"g\", {\n    onMouseLeave: function onMouseLeave() {\n      return handleFocus(null);\n    },\n    style: {\n      transform: translate(gridDimensions.left, gridDimensions.top)\n    }\n  }, polygons.map(function (points, i) {\n    var index = points.index;\n    var datum = voronoiData[index].datum;\n    var path = delaunayLineFn(points) || undefined;\n    return /*#__PURE__*/React.createElement(\"path\", {\n      key: i,\n      d: path,\n      className: 'action-voronoi',\n      onMouseEnter: function onMouseEnter() {\n        return handleFocus(datum);\n      },\n      style: {\n        fill: getOptions().dark ? '#ffffff33' : 'rgba(0,0,0,0.2)',\n        strokeWidth: 1,\n        stroke: getOptions().dark ? 'white' : 'black',\n        opacity: getOptions().showVoronoi ? 1 : 0\n      }\n    });\n  }));\n}\n\nfunction getX(datum, primaryAxis, secondaryAxis, useBarPx) {\n  return primaryAxis.isVertical ? getSecondary(datum, secondaryAxis) : getPrimary(datum, primaryAxis, secondaryAxis, useBarPx);\n}\n\nfunction getY(datum, primaryAxis, secondaryAxis, useBarPx) {\n  return primaryAxis.isVertical ? getPrimary(datum, primaryAxis, secondaryAxis, useBarPx) : getSecondary(datum, secondaryAxis);\n}\n\nfunction getPrimary(datum, primaryAxis, secondaryAxis, useBarPx) {\n  var _primaryAxis$scale;\n\n  var primary = (_primaryAxis$scale = primaryAxis.scale(datum.primaryValue)) != null ? _primaryAxis$scale : NaN;\n\n  if (useBarPx && secondaryAxis.elementType === 'bar') {\n    if (!secondaryAxis.stacked) {\n      var _ref4;\n\n      primary += (_ref4 = primaryAxis.seriesBandScale(datum.seriesIndex)) != null ? _ref4 : NaN;\n      primary += getPrimaryLength(datum, primaryAxis, secondaryAxis) / 2;\n    } else {\n      primary += getPrimaryGroupLength(datum, primaryAxis) / 2;\n    }\n  }\n\n  return primary;\n}\n\nfunction getSecondary(datum, secondaryAxis) {\n  var _secondaryAxis$scale5;\n\n  if (secondaryAxis.stacked) {\n    var _secondaryAxis$scale4, _datum$stackData$, _datum$stackData4;\n\n    return (_secondaryAxis$scale4 = secondaryAxis.scale((_datum$stackData$ = (_datum$stackData4 = datum.stackData) == null ? void 0 : _datum$stackData4[1]) != null ? _datum$stackData$ : NaN)) != null ? _secondaryAxis$scale4 : NaN;\n  }\n\n  return (_secondaryAxis$scale5 = secondaryAxis.scale(datum.secondaryValue)) != null ? _secondaryAxis$scale5 : NaN;\n}","map":{"version":3,"sources":["/home/ralph1/Documents/3rd_year/software_eng/react/github_visaulisation/node_modules/react-charts/es/components/Voronoi.js"],"names":["React","Delaunay","translate","useChartContext","line","getPrimaryGroupLength","getPrimaryLength","Voronoi","_useChartContext","getOptions","focusedDatumState","setFocusedDatum","_getOptions","onFocusDatum","onClickDatum","tooltip","primaryCursor","secondaryCursor","showVoronoi","interactionMode","handleFocus","useCallback","datum","_getOptions$onFocusDa","_getOptions2","call","needsVoronoi","props","createElement","SingleVoronoi","PrimaryVoronoi","_ref","_useChartContext2","primaryAxis","secondaryAxes","gridDimensions","datumsByInteractionGroup","stackedVoronoi","length","stacked","useBarPx","every","d","elementType","useMemo","preColumns","Array","from","entries","map","_ref2","_","datums","filter","primaryValue","sort","a","b","aAxis","find","id","secondaryAxisId","bAxis","aPx","getPrimary","bPx","isVertical","reverse","columns","i","all","_primaryAxis$scale$ra","prev","next","secondaryAxis","primaryPx","range","scale","primaryStart","primaryEnd","_secondaryAxis","prevPx","_secondaryAxis2","nextPx","datumBoundaries","secondaryValue","_secondaryAxis$scale3","_datum$stackData3","_secondaryAxis$scale$2","_secondaryAxis$scale$","_datum$stackData","_datum$stackData2","_range","stackData","_secondaryStart","_secondaryEnd","_secondaryAxis$scale","_stackData$","NaN","_secondaryAxis$scale2","_stackData$2","secondaryStart","secondaryEnd","value","_prevAxis$scale","_prev$stackData","prevAxis","prevValue","_nextAxis$scale","_next$stackData","nextAxis","nextValue","onMouseLeave","style","transform","left","top","column","key","datumBoundary","x1","x2","y1","y2","x","Math","min","y","xEnd","max","yEnd","height","width","className","onMouseEnter","fill","dark","strokeWidth","stroke","opacity","delaunayLineFn","_ref3","_useChartContext3","series","polygons","voronoiData","forEach","serie","getX","getY","Number","isNaN","push","delaunay","voronoi","cellPolygons","points","index","path","undefined","getSecondary","_primaryAxis$scale","primary","_ref4","seriesBandScale","seriesIndex","_secondaryAxis$scale5","_secondaryAxis$scale4","_datum$stackData$","_datum$stackData4"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Delaunay } from 'd3-delaunay'; //\n\nimport { translate } from '../utils/Utils';\nimport useChartContext from '../utils/chartContext';\nimport { line } from 'd3-shape';\nimport { getPrimaryGroupLength, getPrimaryLength } from '../seriesTypes/Bar';\nexport default function Voronoi() {\n  var _useChartContext = useChartContext(),\n      getOptions = _useChartContext.getOptions,\n      focusedDatumState = _useChartContext.focusedDatumState;\n\n  var setFocusedDatum = focusedDatumState[1];\n\n  var _getOptions = getOptions(),\n      onFocusDatum = _getOptions.onFocusDatum,\n      onClickDatum = _getOptions.onClickDatum,\n      tooltip = _getOptions.tooltip,\n      primaryCursor = _getOptions.primaryCursor,\n      secondaryCursor = _getOptions.secondaryCursor,\n      showVoronoi = _getOptions.showVoronoi,\n      interactionMode = _getOptions.interactionMode;\n\n  var handleFocus = React.useCallback(function (datum) {\n    var _getOptions$onFocusDa, _getOptions2;\n\n    (_getOptions$onFocusDa = (_getOptions2 = getOptions()).onFocusDatum) == null ? void 0 : _getOptions$onFocusDa.call(_getOptions2, datum);\n    setFocusedDatum(datum);\n  }, [getOptions, setFocusedDatum]);\n  var needsVoronoi = onFocusDatum || onClickDatum || tooltip || primaryCursor || secondaryCursor || showVoronoi;\n\n  if (!needsVoronoi) {\n    return null;\n  }\n\n  var props = {\n    handleFocus: handleFocus\n  };\n\n  if (interactionMode === 'closest') {\n    return /*#__PURE__*/React.createElement(SingleVoronoi, props);\n  }\n\n  return /*#__PURE__*/React.createElement(PrimaryVoronoi, props);\n}\n\nfunction PrimaryVoronoi(_ref) {\n  var handleFocus = _ref.handleFocus;\n\n  var _useChartContext2 = useChartContext(),\n      primaryAxis = _useChartContext2.primaryAxis,\n      secondaryAxes = _useChartContext2.secondaryAxes,\n      getOptions = _useChartContext2.getOptions,\n      gridDimensions = _useChartContext2.gridDimensions,\n      datumsByInteractionGroup = _useChartContext2.datumsByInteractionGroup;\n\n  var stackedVoronoi = secondaryAxes.length === 1 && secondaryAxes[0].stacked;\n  var useBarPx = secondaryAxes.every(function (d) {\n    return d.elementType === 'bar' && !d.stacked;\n  });\n  return React.useMemo(function () {\n    var preColumns = Array.from(datumsByInteractionGroup.entries()).map(function (_ref2) {\n      var _ = _ref2[0],\n          datums = _ref2[1];\n      return datums;\n    }).filter(function (datums) {\n      var datum = datums[0];\n\n      if (!datum) {\n        return;\n      }\n\n      var primaryValue = datum.primaryValue;\n      return primaryValue !== 'undefined' && primaryValue !== null;\n    }).sort(function (a, b) {\n      var aAxis = secondaryAxes.find(function (d) {\n        return d.id === a[0].secondaryAxisId;\n      });\n      var bAxis = secondaryAxes.find(function (d) {\n        return d.id === b[0].secondaryAxisId;\n      });\n      var aPx = getPrimary(a[0], primaryAxis, aAxis, useBarPx);\n      var bPx = getPrimary(b[0], primaryAxis, bAxis, useBarPx);\n      return aPx - bPx;\n    });\n\n    if (primaryAxis.isVertical) {\n      preColumns.reverse();\n    }\n\n    var columns = preColumns.map(function (datums, i, all) {\n      var _primaryAxis$scale$ra;\n\n      var datum = datums[0];\n      var prev = all[i - 1];\n      var next = all[i + 1];\n      var secondaryAxis = secondaryAxes.find(function (d) {\n        return d.id === datum.secondaryAxisId;\n      });\n      var primaryPx = getPrimary(datum, primaryAxis, secondaryAxis, useBarPx);\n      var range = (_primaryAxis$scale$ra = primaryAxis == null ? void 0 : primaryAxis.scale.range()) != null ? _primaryAxis$scale$ra : [0, 0];\n      var primaryStart = range[0],\n          primaryEnd = range[1];\n\n      if (prev) {\n        var _secondaryAxis = secondaryAxes.find(function (d) {\n          return d.id === prev[0].secondaryAxisId;\n        });\n\n        var prevPx = getPrimary(prev[0], primaryAxis, _secondaryAxis, useBarPx);\n        primaryStart = primaryPx - (primaryPx - prevPx) / 2;\n      }\n\n      if (next) {\n        var _secondaryAxis2 = secondaryAxes.find(function (d) {\n          return d.id === next[0].secondaryAxisId;\n        });\n\n        var nextPx = getPrimary(next[0], primaryAxis, _secondaryAxis2, useBarPx);\n        primaryEnd = primaryPx + (nextPx - primaryPx) / 2;\n      }\n\n      return {\n        primaryStart: primaryStart,\n        primaryEnd: primaryEnd,\n        primaryPx: primaryPx,\n        datumBoundaries: datums.filter(function (datum) {\n          var secondaryValue = datum.secondaryValue;\n          return typeof secondaryValue !== 'undefined' && secondaryValue !== null;\n        }).map(function (datum, i, all) {\n          var _secondaryAxis$scale3, _datum$stackData3, _secondaryAxis$scale$2;\n\n          var prev = all[i - 1];\n          var next = all[i + 1];\n          var secondaryAxis = secondaryAxes.find(function (d) {\n            return d.id === datum.secondaryAxisId;\n          });\n\n          if (stackedVoronoi) {\n            var _secondaryAxis$scale$, _datum$stackData, _datum$stackData2;\n\n            var _range = (_secondaryAxis$scale$ = secondaryAxis == null ? void 0 : secondaryAxis.scale.range()) != null ? _secondaryAxis$scale$ : [0, 0];\n\n            var stackData = [(_datum$stackData = datum.stackData) == null ? void 0 : _datum$stackData[0], (_datum$stackData2 = datum.stackData) == null ? void 0 : _datum$stackData2[1]];\n\n            if (secondaryAxis != null && secondaryAxis.isVertical) {\n              _range.reverse();\n\n              stackData.reverse();\n            }\n\n            var _secondaryStart = _range[0],\n                _secondaryEnd = _range[1];\n\n            if (prev) {\n              var _secondaryAxis$scale, _stackData$;\n\n              _secondaryStart = (_secondaryAxis$scale = secondaryAxis == null ? void 0 : secondaryAxis.scale((_stackData$ = stackData[0]) != null ? _stackData$ : NaN)) != null ? _secondaryAxis$scale : NaN;\n            }\n\n            if (next) {\n              var _secondaryAxis$scale2, _stackData$2;\n\n              _secondaryEnd = (_secondaryAxis$scale2 = secondaryAxis == null ? void 0 : secondaryAxis.scale((_stackData$2 = stackData[1]) != null ? _stackData$2 : NaN)) != null ? _secondaryAxis$scale2 : NaN;\n            }\n\n            return {\n              secondaryStart: _secondaryStart,\n              secondaryEnd: _secondaryEnd,\n              datum: datum\n            };\n          }\n\n          var value = (_secondaryAxis$scale3 = secondaryAxis == null ? void 0 : secondaryAxis.scale(secondaryAxis.stacked ? (_datum$stackData3 = datum.stackData) == null ? void 0 : _datum$stackData3[1] : datum.secondaryValue)) != null ? _secondaryAxis$scale3 : NaN;\n          var range = (_secondaryAxis$scale$2 = secondaryAxis == null ? void 0 : secondaryAxis.scale.range()) != null ? _secondaryAxis$scale$2 : [0, 0];\n\n          if (secondaryAxis != null && secondaryAxis.isVertical) {\n            range.reverse();\n          }\n\n          var secondaryStart = range[0],\n              secondaryEnd = range[1];\n\n          if (prev) {\n            var _prevAxis$scale, _prev$stackData;\n\n            var prevAxis = secondaryAxes.find(function (d) {\n              return d.id === (prev == null ? void 0 : prev.secondaryAxisId);\n            });\n            var prevValue = (_prevAxis$scale = prevAxis == null ? void 0 : prevAxis.scale(prevAxis.stacked ? (_prev$stackData = prev.stackData) == null ? void 0 : _prev$stackData[1] : prev.secondaryValue)) != null ? _prevAxis$scale : NaN;\n            secondaryStart = value - (value - prevValue) / 2;\n          }\n\n          if (next) {\n            var _nextAxis$scale, _next$stackData;\n\n            var nextAxis = secondaryAxes.find(function (d) {\n              return d.id === (next == null ? void 0 : next.secondaryAxisId);\n            });\n            var nextValue = (_nextAxis$scale = nextAxis == null ? void 0 : nextAxis.scale(nextAxis.stacked ? (_next$stackData = next.stackData) == null ? void 0 : _next$stackData[1] : next.secondaryValue)) != null ? _nextAxis$scale : NaN;\n            secondaryEnd = value + (nextValue - value) / 2;\n          }\n\n          return {\n            secondaryStart: secondaryStart,\n            secondaryEnd: secondaryEnd,\n            datum: datum\n          };\n        })\n      };\n    });\n    return /*#__PURE__*/React.createElement(\"g\", {\n      onMouseLeave: function onMouseLeave() {\n        return handleFocus(null);\n      },\n      style: {\n        transform: translate(gridDimensions.left, gridDimensions.top)\n      }\n    }, columns.map(function (column, i) {\n      return /*#__PURE__*/React.createElement(\"g\", {\n        key: column.primaryPx + \"_\" + i\n      }, column.datumBoundaries.map(function (datumBoundary, i) {\n        var x1 = !primaryAxis.isVertical ? column.primaryStart : datumBoundary.secondaryStart;\n        var x2 = !primaryAxis.isVertical ? column.primaryEnd : datumBoundary.secondaryEnd;\n        var y1 = !primaryAxis.isVertical ? datumBoundary.secondaryStart : column.primaryStart;\n        var y2 = !primaryAxis.isVertical ? datumBoundary.secondaryEnd : column.primaryEnd;\n        var x = Math.min(x1, x2);\n        var y = Math.min(y1, y2);\n        var xEnd = Math.max(x1, x2);\n        var yEnd = Math.max(y1, y2);\n        var height = Math.max(yEnd - y, 0);\n        var width = Math.max(xEnd - x, 0);\n        return /*#__PURE__*/React.createElement(\"rect\", {\n          key: i,\n          x: x,\n          y: y,\n          width: width,\n          height: height,\n          className: 'action-voronoi',\n          onMouseEnter: function onMouseEnter() {\n            return handleFocus(datumBoundary.datum);\n          },\n          style: {\n            fill: getOptions().dark ? '#ffffff33' : 'rgba(0,0,0,0.2)',\n            strokeWidth: 1,\n            stroke: getOptions().dark ? 'white' : 'black',\n            opacity: getOptions().showVoronoi ? 1 : 0\n          }\n        });\n      }));\n    }));\n  }, [datumsByInteractionGroup, primaryAxis, gridDimensions.left, gridDimensions.top, secondaryAxes, useBarPx, stackedVoronoi, handleFocus, getOptions]);\n}\n\nvar delaunayLineFn = line();\n\nfunction SingleVoronoi(_ref3) {\n  var handleFocus = _ref3.handleFocus;\n\n  var _useChartContext3 = useChartContext(),\n      primaryAxis = _useChartContext3.primaryAxis,\n      series = _useChartContext3.series,\n      secondaryAxes = _useChartContext3.secondaryAxes,\n      getOptions = _useChartContext3.getOptions,\n      gridDimensions = _useChartContext3.gridDimensions;\n\n  var polygons = null;\n  var voronoiData = [];\n  var useBarPx = secondaryAxes.every(function (d) {\n    return d.elementType === 'bar' && !d.stacked;\n  });\n  series.forEach(function (serie) {\n    serie.datums.filter(function (datum) {\n      var primaryValue = datum.primaryValue;\n      var secondaryValue = datum.secondaryValue;\n      return primaryValue !== 'undefined' && primaryValue !== null && secondaryValue !== 'undefined' && secondaryValue !== null;\n    }).forEach(function (datum) {\n      var secondaryAxis = secondaryAxes.find(function (d) {\n        return d.id === datum.secondaryAxisId;\n      });\n      var x = getX(datum, primaryAxis, secondaryAxis, useBarPx);\n      var y = getY(datum, primaryAxis, secondaryAxis, useBarPx);\n\n      if (typeof x !== 'number' || typeof y !== 'number' || Number.isNaN(y) || Number.isNaN(x)) {\n        return;\n      }\n\n      voronoiData.push({\n        x: x,\n        y: y,\n        datum: datum\n      });\n    });\n  });\n  var delaunay = Delaunay.from(voronoiData, function (d) {\n    return Math.max(d.x, 0);\n  }, function (d) {\n    return Math.max(d.y, 0);\n  });\n  var voronoi = delaunay.voronoi([0, 0, gridDimensions.width, gridDimensions.height]);\n  polygons = voronoi.cellPolygons();\n  polygons = Array.from(polygons);\n  return /*#__PURE__*/React.createElement(\"g\", {\n    onMouseLeave: function onMouseLeave() {\n      return handleFocus(null);\n    },\n    style: {\n      transform: translate(gridDimensions.left, gridDimensions.top)\n    }\n  }, polygons.map(function (points, i) {\n    var index = points.index;\n    var datum = voronoiData[index].datum;\n    var path = delaunayLineFn(points) || undefined;\n    return /*#__PURE__*/React.createElement(\"path\", {\n      key: i,\n      d: path,\n      className: 'action-voronoi',\n      onMouseEnter: function onMouseEnter() {\n        return handleFocus(datum);\n      },\n      style: {\n        fill: getOptions().dark ? '#ffffff33' : 'rgba(0,0,0,0.2)',\n        strokeWidth: 1,\n        stroke: getOptions().dark ? 'white' : 'black',\n        opacity: getOptions().showVoronoi ? 1 : 0\n      }\n    });\n  }));\n}\n\nfunction getX(datum, primaryAxis, secondaryAxis, useBarPx) {\n  return primaryAxis.isVertical ? getSecondary(datum, secondaryAxis) : getPrimary(datum, primaryAxis, secondaryAxis, useBarPx);\n}\n\nfunction getY(datum, primaryAxis, secondaryAxis, useBarPx) {\n  return primaryAxis.isVertical ? getPrimary(datum, primaryAxis, secondaryAxis, useBarPx) : getSecondary(datum, secondaryAxis);\n}\n\nfunction getPrimary(datum, primaryAxis, secondaryAxis, useBarPx) {\n  var _primaryAxis$scale;\n\n  var primary = (_primaryAxis$scale = primaryAxis.scale(datum.primaryValue)) != null ? _primaryAxis$scale : NaN;\n\n  if (useBarPx && secondaryAxis.elementType === 'bar') {\n    if (!secondaryAxis.stacked) {\n      var _ref4;\n\n      primary += (_ref4 = primaryAxis.seriesBandScale(datum.seriesIndex)) != null ? _ref4 : NaN;\n      primary += getPrimaryLength(datum, primaryAxis, secondaryAxis) / 2;\n    } else {\n      primary += getPrimaryGroupLength(datum, primaryAxis) / 2;\n    }\n  }\n\n  return primary;\n}\n\nfunction getSecondary(datum, secondaryAxis) {\n  var _secondaryAxis$scale5;\n\n  if (secondaryAxis.stacked) {\n    var _secondaryAxis$scale4, _datum$stackData$, _datum$stackData4;\n\n    return (_secondaryAxis$scale4 = secondaryAxis.scale((_datum$stackData$ = (_datum$stackData4 = datum.stackData) == null ? void 0 : _datum$stackData4[1]) != null ? _datum$stackData$ : NaN)) != null ? _secondaryAxis$scale4 : NaN;\n  }\n\n  return (_secondaryAxis$scale5 = secondaryAxis.scale(datum.secondaryValue)) != null ? _secondaryAxis$scale5 : NaN;\n}"]},"metadata":{},"sourceType":"module"}